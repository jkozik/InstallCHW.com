# InstallCHW.com
This script installs CamptonHillsWeather.com onto a docker container.
It is made from the scripts at Saratoga Weather. With this repository, I hope to automate putting these scripts into a docker container, making it easier for me to keep up to date and move as my server environment evolves.

```
# To get started, clone the repository, build and run it
$ git clone https://github.com/jkozik/InstallCHW.com
$ docker build -t jkozik/chw.com .
$ docker run -dit --name chw.com-app -p 8083:80 -v /home/weather/public_html:/var/www/html/mount jkozik/chw.com

# shell prompt, logs, and restart needed for rebuild
$ docker exec -it chw.com-app /bin/bash
$ docker logs -f .com-app
$ docker stop chw.com-app; docker rm chw.com-app

```

This container mounts a host directory (see -v option above). The data is generated by the Cumulus program that uploads to the host from a separte Windows 10 instance.  The following data is expected there (note: below doesn't show full path):
```
-realtime.txt -- key realtime file updated every minute
-davconfcst.php,davcon24.txt -- data to recreate the Davis Console.  Scripts from Silver Acron Weather
-Reports/ -- Cumulus reports by month
-images/ -- Cumulus station graphes
-awekas_wl.htm -- retrieved by https://www.awekas.at/

```
The Cumulus program has an Internet Files menu tab that generates these files from templates.  Setup for generating these files is outside of the scope for this repository.

About the -v option.

This container is a web server that displays weather data.  The scripts that generate the data come from the Saratoga weather web site.
The container gets all of its data from the mount shown in the -v option below.  That data is generated from a program called Cumulus.  It has an ethernet interface to my Davis weather station.  It polls my weather station, generates graphes, screens, and real time data files.
This data gets ftp'd to my host computer.  The data sits outside of my container; the -v option maps that data to my container.

Now in my case.  My host runs VirtualBox.  Within my VB installation I run Virtual Machines for one reason or another.  One of my VMs I use for containers.  So my setup requires that I share data between my host and VB and VB and the container.
```
HOST <-> VB VMs <-> Containers
```

So outside of this install script, my VB VM that runs this container gets the following settings:
```
Shared Folders / Machine Folders
-Folder Path /home/weather/public_html
-Folder Name weather    Auto-mount, Make Permanent
```

And, my VB VM that is running this container must be setup to support VB shared folders:
```
# mkdir /mount; mkdir /mount/weather
# mount -t vboxsf weather /mount/weather
# vi /etc/fstab     -- add the line "weather /mount/weather  vboxsf  defaults 0 0"
# vi /etc/modules   -- add the line "vboxfs"
```

So if I ran docker native on my host I wouldn't need this, but on my host I am running docker, kubernetes, and native applications.  For me, it is easier to keep my projects in VMs to that I don't create dependencies between my projects.  

So why bother with this setup?

I have been running weather software on my home servers for years.  Since 2004. And every couple of years, I am triggered to re-setup everything. By automating my setup as much as possible, I hope to reduce the amount of work I have to do to re-setup everything.  Maybe someday, I'll want to move everything to a hosted / cloud service.  If I am on docker, the setup / re-setup will be lower. All the cloud hosting services support docker with very low getting started monthly costs.  But for now, this is on my home servers rack, and I am purely doing this to save me some time.


https://stackoverflow.com/questions/45928842/multiple-volumes-to-single-target-directory
multiple containers share the same mount point on host

er run -dit -v /mount/weather:/mount/weather --name data-storage php:7.2-apache
 283 docker exec -it data-storage /bin/bash
 284 docker ps
 285 docker stop chw.com-app;docker rm chw.com-app
 286 docker run -dit --name nw.net-app -p 8080:80 --volumes-from data-storage  jkozik/nw.net
 287 docker exec -it nw-net-app /bin/bash
 288 docker exec -it nw.net-app /bin/bash
 289 history

docker run -dit -v /mount/weather:/mount/weather --name data-storage php:7.2-apache
docker exec -it data-storage /bin/bash   # verify /mount/weather/cumulus/realtime.txt
docker run -dit --name chw.com-app -p 8083:80 --volumes-from data-storage  jkozik/chw.net
